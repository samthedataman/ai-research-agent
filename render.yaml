services:
  # ── API + WhatsApp Webhooks (free web service) ──
  - type: web
    name: ai-research-api
    env: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn api:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: LLM_PROVIDER
        value: openrouter
      - key: OPENROUTER_API_KEY
        sync: false
      - key: OPENROUTER_MODEL
        value: deepseek/deepseek-chat
      - key: OLLAMA_ANALYSIS_MODEL
        value: deepseek/deepseek-chat
      - key: PYTHON_VERSION
        value: "3.12.1"
      - key: WHATSAPP_ACCESS_TOKEN
        sync: false
      - key: WHATSAPP_PHONE_NUMBER_ID
        sync: false
      - key: WHATSAPP_VERIFY_TOKEN
        sync: false
      - key: WHATSAPP_APP_SECRET
        sync: false
      - key: GREENAPI_INSTANCE_ID
        sync: false
      - key: GREENAPI_API_TOKEN
        sync: false
      - key: GREENAPI_GROUP_ID
        sync: false

  # ── Telegram Bot + Daily Scheduler (free worker) ──
  - type: worker
    name: telegram-bot
    env: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: LLM_PROVIDER
        value: openrouter
      - key: OPENROUTER_API_KEY
        sync: false
      - key: OPENROUTER_MODEL
        value: deepseek/deepseek-chat
      - key: OLLAMA_ANALYSIS_MODEL
        value: deepseek/deepseek-chat
      - key: GREENAPI_INSTANCE_ID
        sync: false
      - key: GREENAPI_API_TOKEN
        sync: false
      - key: GREENAPI_GROUP_ID
        sync: false
      - key: DAILY_BRIEFING_HOUR
        value: "7"
      - key: DAILY_BRIEFING_MINUTE
        value: "0"
      - key: DAILY_BRIEFING_SOURCES
        value: "news,crypto,stocks"
